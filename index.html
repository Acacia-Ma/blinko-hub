<!DOCTYPE html>
<html>
<head>
    <title>Blinko Sites API</title>
    <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
<script>
(async () => {
    try {
        const response = await fetch('https://raw.githubusercontent.com/blinko-space/blinko-hub/main/site.yml');
        const yamlText = await response.text();
        const data = jsyaml.load(yamlText);
        
        // Get query parameters
        const urlParams = new URLSearchParams(window.location.search);
        const tag = urlParams.get('tag');
        const category = urlParams.get('category');
        const q = urlParams.get('q');
        
        let result = data.sites;
        
        // Filter by tag
        if (tag) {
            result = result.filter(site => site.tags.includes(tag));
        }
        
        // Filter by category
        if (category) {
            result = result.filter(site => site.category.toLowerCase() === category.toLowerCase());
        }
        
        // Search
        if (q) {
            const searchTerm = q.toLowerCase();
            result = result.filter(site => 
                site.title.toLowerCase().includes(searchTerm) ||
                site.description.toLowerCase().includes(searchTerm) ||
                site.tags.some(tag => tag.toLowerCase().includes(searchTerm))
            );
        }
        
        // Return JSON result
        document.write(JSON.stringify(result));
    } catch (error) {
        document.write(JSON.stringify({ error: 'Failed to fetch sites data' }));
    }
})();
</script>
</body>
</html> 